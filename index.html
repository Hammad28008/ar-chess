<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AR Chess with Camera</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    
    <style>
        * { margin: 0; padding: 0; overflow: hidden; }
        
        #startScreen {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: black;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            text-align: center;
        }
        
        #startButton {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 50px;
            margin-top: 20px;
            cursor: pointer;
        }
        
        #status {
            position: absolute;
            bottom: 20px;
            left: 0; right: 0;
            text-align: center;
            color: white;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            z-index: 999;
        }
    </style>
</head>
<body>
    <div id="startScreen">
        <h1>AR Chess</h1>
        <p>Click below to start camera and view chess pieces</p>
        <button id="startButton">START CAMERA</button>
    </div>
    
    <div id="status">Waiting for camera...</div>
    
    <!-- A-FRAME SCENE -->
    <a-scene vr-mode-ui="enabled: false" embedded>
        <!-- Camera feed as background -->
        <a-entity id="cameraBackground"></a-entity>
        
        <!-- Chess pieces positioned closer to camera -->
        <a-entity position="0 0 -2">
            <!-- Chess Board -->
            <a-box position="0 -0.5 0" width="1.5" height="0.1" depth="1.5" color="#8B4513"></a-box>
            
            <!-- White Pieces -->
            <a-cylinder position="-0.5 0.2 0.5" radius="0.08" height="0.4" color="white"></a-cylinder>
            <a-cylinder position="-0.5 0.2 -0.5" radius="0.08" height="0.4" color="white"></a-cylinder>
            <a-sphere position="-0.2 0.15 0.2" radius="0.06" color="white"></a-sphere>
            
            <!-- Black Pieces -->
            <a-cylinder position="0.5 0.2 0.5" radius="0.08" height="0.4" color="black"></a-cylinder>
            <a-cylinder position="0.5 0.2 -0.5" radius="0.08" height="0.4" color="black"></a-cylinder>
            <a-sphere position="0.2 0.15 0.2" radius="0.06" color="black"></a-sphere>
        </a-entity>
        
        <!-- Camera -->
        <a-entity camera look-controls wasd-controls="enabled: false"></a-entity>
    </a-scene>
    
    <script>
        // Get elements
        const startScreen = document.getElementById('startScreen');
        const startButton = document.getElementById('startButton');
        const status = document.getElementById('status');
        const scene = document.querySelector('a-scene');
        
        // Camera feed component
        AFRAME.registerComponent('camera-background', {
            init: function() {
                navigator.mediaDevices.getUserMedia({ video: true })
                    .then(stream => {
                        // Create video element
                        const video = document.createElement('video');
                        video.srcObject = stream;
                        video.autoplay = true;
                        video.playsInline = true;
                        
                        // Set as scene background
                        scene.setAttribute('background', { src: video });
                        
                        // Hide start screen
                        startScreen.style.display = 'none';
                        status.textContent = "✅ Camera active! Look around and tap pieces.";
                        
                        // Make pieces clickable
                        document.querySelectorAll('a-cylinder, a-sphere').forEach(piece => {
                            piece.addEventListener('click', function() {
                                const rotation = this.getAttribute('rotation') || {x:0, y:0, z:0};
                                this.setAttribute('rotation', {
                                    x: rotation.x,
                                    y: rotation.y + 90,
                                    z: rotation.z
                                });
                                
                                // Visual feedback
                                const originalColor = this.getAttribute('color');
                                this.setAttribute('color', 'red');
                                setTimeout(() => {
                                    this.setAttribute('color', originalColor);
                                }, 200);
                            });
                        });
                    })
                    .catch(err => {
                        status.textContent = "❌ Camera error: " + err.message;
                        status.style.color = "red";
                    });
            }
        });
        
        // Start when button clicked
        startButton.addEventListener('click', () => {
            status.textContent = "Requesting camera access...";
            
            // Add camera background component
            document.getElementById('cameraBackground').setAttribute('camera-background', '');
            
            // Enter VR mode for fullscreen
            setTimeout(() => {
                if (scene.enterVR) {
                    scene.enterVR();
                }
            }, 1000);
        });
        
        // Auto-start on mobile after 2 seconds
        if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
            setTimeout(() => {
                startButton.click();
            }, 2000);
        }
    </script>
</body>
</html>
